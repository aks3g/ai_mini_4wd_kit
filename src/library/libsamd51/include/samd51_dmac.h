/*
 * samd51_dmac.h
 *
 * Created: 2023/03/01 17:10:35
 *  Author: kiyot
 */ 


#ifndef SAMD51_DMAC_H_
#define SAMD51_DMAC_H_

typedef enum SAMD51_DMAC_TRIGSRC_t
{
	SAMD51_DMAC_TRIGSRC_DISABLE			= 0,
	SAMD51_DMAC_TRIGSRC_RTC_TIMESTAMP	,
	SAMD51_DMAC_TRIGSRC_DSU_DCC0		,
	SAMD51_DMAC_TRIGSRC_DSU_DCC1		,
	SAMD51_DMAC_TRIGSRC_SERCOM0_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM0_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM1_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM1_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM2_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM2_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM3_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM3_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM4_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM4_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM5_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM5_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM6_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM6_TX		,
	SAMD51_DMAC_TRIGSRC_SERCOM7_RX		,
	SAMD51_DMAC_TRIGSRC_SERCOM7_TX		,
	SAMD51_DMAC_TRIGSRC_CAN0_DEBUG		,
	SAMD51_DMAC_TRIGSRC_CAN1_DEBUG		,
	SAMD51_DMAC_TRIGSRC_TCC0_OVF		,
	SAMD51_DMAC_TRIGSRC_TCC0_MC0		,
	SAMD51_DMAC_TRIGSRC_TCC0_MC1		,
	SAMD51_DMAC_TRIGSRC_TCC0_MC2		,
	SAMD51_DMAC_TRIGSRC_TCC0_MC3		,
	SAMD51_DMAC_TRIGSRC_TCC0_MC4		,
	SAMD51_DMAC_TRIGSRC_TCC0_MC5		,
	SAMD51_DMAC_TRIGSRC_TCC1_OVF		,
	SAMD51_DMAC_TRIGSRC_TCC1_MC0		,
	SAMD51_DMAC_TRIGSRC_TCC1_MC1		,
	SAMD51_DMAC_TRIGSRC_TCC1_MC2		,
	SAMD51_DMAC_TRIGSRC_TCC1_MC3		,
	SAMD51_DMAC_TRIGSRC_TCC2_OVF		,
	SAMD51_DMAC_TRIGSRC_TCC2_MC0		,
	SAMD51_DMAC_TRIGSRC_TCC2_MC1		,
	SAMD51_DMAC_TRIGSRC_TCC2_MC2		,
	SAMD51_DMAC_TRIGSRC_TCC3_OVF		,
	SAMD51_DMAC_TRIGSRC_TCC3_MC0		,
	SAMD51_DMAC_TRIGSRC_TCC3_MC1		,
	SAMD51_DMAC_TRIGSRC_TCC4_OVF		,
	SAMD51_DMAC_TRIGSRC_TCC4_MC0		,
	SAMD51_DMAC_TRIGSRC_TCC4_MC1		,
	SAMD51_DMAC_TRIGSRC_TC0_OVF			,
	SAMD51_DMAC_TRIGSRC_TC0_MC0			,
	SAMD51_DMAC_TRIGSRC_TC0_MC1			,
	SAMD51_DMAC_TRIGSRC_TC1_OVF			,
	SAMD51_DMAC_TRIGSRC_TC1_MC0			,
	SAMD51_DMAC_TRIGSRC_TC1_MC1			,
	SAMD51_DMAC_TRIGSRC_TC2_OVF			,
	SAMD51_DMAC_TRIGSRC_TC2_MC0			,
	SAMD51_DMAC_TRIGSRC_TC2_MC1			,
	SAMD51_DMAC_TRIGSRC_TC3_OVF			,
	SAMD51_DMAC_TRIGSRC_TC3_MC0			,
	SAMD51_DMAC_TRIGSRC_TC3_MC1			,
	SAMD51_DMAC_TRIGSRC_TC4_OVF			,
	SAMD51_DMAC_TRIGSRC_TC4_MC0			,
	SAMD51_DMAC_TRIGSRC_TC4_MC1			,
	SAMD51_DMAC_TRIGSRC_TC5_OVF			,
	SAMD51_DMAC_TRIGSRC_TC5_MC0			,
	SAMD51_DMAC_TRIGSRC_TC5_MC1			,
	SAMD51_DMAC_TRIGSRC_TC6_OVF			,
	SAMD51_DMAC_TRIGSRC_TC6_MC0			,
	SAMD51_DMAC_TRIGSRC_TC6_MC1			,
	SAMD51_DMAC_TRIGSRC_TC7_OVF			,
	SAMD51_DMAC_TRIGSRC_TC7_MC0			,
	SAMD51_DMAC_TRIGSRC_TC7_MC1			,
	SAMD51_DMAC_TRIGSRC_ADC0_RESRDY		,
	SAMD51_DMAC_TRIGSRC_ADC0_SEQ		,
	SAMD51_DMAC_TRIGSRC_ADC1_RESRDY		,
	SAMD51_DMAC_TRIGSRC_ADC1_SEQ		,
	SAMD51_DMAC_TRIGSRC_DAC_EMPTY0		,
	SAMD51_DMAC_TRIGSRC_DAC_EMPTY1		,
	SAMD51_DMAC_TRIGSRC_DAC_RESRDY0		,
	SAMD51_DMAC_TRIGSRC_DAC_RESRDY1		,
	SAMD51_DMAC_TRIGSRC_I2S_RX0			,
	SAMD51_DMAC_TRIGSRC_I2S_RX1			,
	SAMD51_DMAC_TRIGSRC_I2S_TX0			,
	SAMD51_DMAC_TRIGSRC_I2S_TX1			,
	SAMD51_DMAC_TRIGSRC_PCC_RX			,
	SAMD51_DMAC_TRIGSRC_AES_WR			,
	SAMD51_DMAC_TRIGSRC_AES_RD			,
	SAMD51_DMAC_TRIGSRC_QSPI_RX			,
	SAMD51_DMAC_TRIGSRC_QSPI_TX			,

} SAMD51_DMAC_TRIGSRC;

typedef enum SAMD51_DMAC_TRIGACT_t
{
	SAMD51_DMAC_TRIGACT_BLOCK = 0,
	SAMD51_DMAC_TRIGACT_RSVD, 
	SAMD51_DMAC_TRIGACT_BURST,
	SAMD51_DMAC_TRIGACT_TRANSACTION, 	
} SAMD51_DMAC_TRIGACT;

#pragma pack(1)
typedef struct REG_DMA_DESC_t
{
	union {
		uint16_t reg;
		struct {
			uint16_t VALID    : 1;
			uint16_t EVOSEL   : 2;
			uint16_t BLOCKACT : 2;
			uint16_t RSVD     : 3;
			uint16_t BEATSIZE : 2;
			uint16_t SRCINC   : 1;
			uint16_t DSTINC   : 1;
			uint16_t STEPSEL  : 1;
			uint16_t STEPSIZE : 3;
		} bf;
	} BTCTRL;

	uint16_t BTCNT;
	void *   SRCADDR;
	void *   DSTADDR;
	struct REG_DMA_DESC_t *next;
} REG_DMA_DESC;
#pragma pack()


typedef void (*SAMD51_DMAC_TRANSACTION_DONE)(int status);

int samd51_dmac_initialize(void);
int samd51_dmac_transaction_start(int ch, SAMD51_DMAC_TRIGSRC trig, SAMD51_DMAC_TRIGACT act, REG_DMA_DESC *p_desc, SAMD51_DMAC_TRANSACTION_DONE cb);
int samd51_dmac_sw_trigger(uint8_t ch);

#endif /* SAMD51_DMAC_H_ */